<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Egyptian Geeks Archive</title>

    <link rel="shortcut icon" href="img/favicon.ico" type="image/png" />
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link href="css/style.css" rel="stylesheet" />

    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="lib/handlebars-v1.3.0.js"></script>
    <script src="lib/moment.min.js"></script>

    <script type="text/javascript">
	function getLastSummeryIndex()
	{
	var index=1;
	$.ajax({url:"data/summaryindex.txt", async: false,success:function(result){
		index=Number(result);
	}});
	return index;
	}
        var QueryString = function () {
            // This function is anonymous, is executed immediately and
            // the return value is assigned to QueryString!
            var query_string = {};
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                // If first entry with this name
                if (typeof query_string[pair[0]] === "undefined") {
                    query_string[pair[0]] = pair[1];
                    // If second entry with this name
                } else if (typeof query_string[pair[0]] === "string") {
                    var arr = [query_string[pair[0]], pair[1]];
                    query_string[pair[0]] = arr;
                    // If third or later entry with this name
                } else {
                    query_string[pair[0]].push(pair[1]);
                }
            }
            return query_string;
        }();

        try {
            var summaryId = getLastSummeryIndex();
            if (QueryString != undefined && QueryString.page != undefined) {
               summaryId =getLastSummeryIndex()-Number(QueryString.page)+1;
            }

            Handlebars.registerHelper('dateFormat', function (context, block) {
                if (window.moment) {
                    var f = block.hash.format || "MMM Do, YYYY";
                    return moment(context).format(f);
                } else {
                    return context;   //  moment plugin not available. return data as is.
                };
            });
			Handlebars.registerHelper('avatar', function (context) {
                 return "http://graph.facebook.com/"+context+"/picture";
			});

			Handlebars.registerHelper('urlify', function (context) {
			    var urlRegex = /(https?:\/\/[^\s]+)/g;
			    return context.replace(urlRegex, function (url) {
			        return '<a href="' + url + '">' + url + '</a>';
			    })
			});

            $.getJSON('data/summary/summary_page_' + summaryId + '.json', function (summaryData) {
                $.get('summaryTemplate.html', function (summaryTemplate) {
                    var summaryCompiledTemplate = Handlebars.compile(summaryTemplate);
                    var summaryHtml = summaryCompiledTemplate(summaryData);
                    $('#summaryDiv').html(summaryHtml);
                });

                if (summaryId != getLastSummeryIndex()) {
                    $('#navArrows').html("<a href='index.html?page=" + (getLastSummeryIndex()- parseInt(summaryId)) + "'><span class='glyphicon glyphicon-chevron-left'></span></a>");
                }
                $('#navArrows').append(" Page " + (getLastSummeryIndex()- parseInt(summaryId)+1) + " ");
                $('#navArrows').append("<a href='index.html?page=" + (getLastSummeryIndex()- parseInt(summaryId) + 2) + "'><span class='glyphicon glyphicon-chevron-right'></span></a>");

            });

        }
        catch (error) {
            console.log(error);
        }
    </script>

</head>
<body class="container">

    <div>
        <a href="index.html"><img class="pull-left" alt="Egyptian Geeks" src="img/EgyptianGeeksLogo.png" /></a>
        <h1 class ="text-right">Egyptian Geeks Archive</h1>
        <h4 class ="text-right"><a href="https://www.facebook.com/groups/egyptian.geeks/">Visit us on Facebook</a></h4>
    </div>
    <br /><br /><br />
    
    <div id="summaryDiv"></div>

    <div id="navArrows" class="text-center">
    </div>

    <br />

</body>
</html>
