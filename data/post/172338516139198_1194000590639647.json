{"id":"172338516139198_1194000590639647","from":{"name":"Mohamed Fergany","id":"10212218310718439"},"message":"السلام عليكم \n\nكان عندنا مشكلة من كام يوم ان السيرفر عندنا مش عارف يهندل 2000 concurrent users بيعملوا 6 مليون ركوست علي السيرفر في اليوم مع ان السيرفر كبير 21 كور و 64 جيجا رامات .\nكان دايما بيدي مشكلة في ال getway . \nظبطنا Nignix علي اكتر من سيرفر و الDistributed Database بال Mongo \n\n حالياً كل الريكوستات متهندله تمام و كله شغال مستقر و لكن الريكوست بياخد وقت طويل .. شغلنا ال Nginx Cache ولكن بردو الريكوستات بتاخد وقت طويل \n\nال 2000 concurrent user بيعملوا عندنا 2000 insert و 2000 select  في الثانية . \nوازاي ممكن نعرف اكتر حاجة بتاخد وقت في الresponse خصوصا ان الشغل متوزع ما بين سيرفرات كتير . \n\nايه ممكن يكون عامل مساعد في ان ال response ياخد وقت كبير . خصوصا ان السيرفرات اللود عليها مش عالي وعادي جدا . \n\nوهل فيه اي حلول تاني ممكن نعملها ؟ \n\n* لغة البرمجة PHP فريم وورك لارفيل .","actions":[{"name":"Comment","link":"https://www.facebook.com/172338516139198/posts/1194000590639647"},{"name":"Like","link":"https://www.facebook.com/172338516139198/posts/1194000590639647"},{"name":"Report Post to Admin","link":"https://www.facebook.com/groups/egyptian.geeks/members/"}],"privacy":{"value":"","description":"","friends":"","allow":"","deny":""},"type":"status","created_time":"2016-08-01T20:37:12+0000","updated_time":"2016-08-03T20:15:36+0000","is_hidden":false,"is_expired":false,"likes":{"data":[{"id":"1454381204603437","name":"Ahmed Sabry"},{"id":"1365689883451330","name":"Osama Nour"},{"id":"10155221820031004","name":"Ahmad Zakaria"},{"id":"781978161955237","name":"Ahmed Mohsen"},{"id":"10158289338975702","name":"Ahmed Samir"},{"id":"10207971913847864","name":"Mohamed Hagras"},{"id":"827049870776926","name":"Ahmed Mohamed Abd El-Hamid"},{"id":"1786709881592928","name":"Ahmed Hashem"},{"id":"421335761534343","name":"Mahmoud Fathy"},{"id":"10154344675857606","name":"Heba El Deeb"},{"id":"1566667340028844","name":"Ahmad Hassan"},{"id":"1348336588561390","name":"Hosam Aly"},{"id":"1423826190982808","name":"Gerges Bernaba"},{"id":"10155294668972384","name":"Osama Ali"}],"paging":{"cursors":{"before":"MTQ1NDM4MTIwNDYwMzQzNwZDZD","after":"MTAxNTUyOTQ2Njg5NzIzODQZD"}}},"comments":{"data":[{"created_time":"2016-08-01T20:39:11+0000","from":{"name":"Abdulrahman Mohamed","id":"1351989794859335"},"message":"ممكن تستخدم حاجة زى newrelic هتعرفك كل حاجة عن السيرفر لحظة بلحظة وهيقولك كل ريكويست اخد وقت اد ايه","can_remove":false,"like_count":7,"user_likes":false,"id":"1194001337306239"},{"created_time":"2016-08-01T21:17:56+0000","from":{"name":"Ahmad Hassan","id":"1566667340028844"},"message":"سبب المشكلة على الاغلب هو NGINX يفضل انكم تضبطوه كـ Proxy لـ Apache عشان تكون وظيفته انه يهندل الملفات الاستاتيك فقط ووالديناميك ل Apache واستخدمو MPM worker في Apache Modules حتكون افضل من الوضع الحالي لانه اعتقد ممكن تنتهي المشكلة على كده لو منتهتش وفي مشاكل حاول في حجات تانية زي انك تستخدم HHVM بعدها لو لسه المشكلة فضلت يبقى ساعتها لازم تفكر انك تشيل Laravel من الاجزاء الي عليه اللود وتستبدله بحاجه Raw","can_remove":false,"like_count":1,"user_likes":false,"id":"1194019300637776"},{"created_time":"2016-08-01T21:29:20+0000","from":{"name":"Mohamed Radwan","id":"10158356933185192"},"message":"ياعم الحج المشكلة ديه اتحلت شوف الحل تحت","can_remove":false,"like_count":0,"user_likes":false,"id":"1194028690636837"},{"created_time":"2016-08-01T21:32:04+0000","from":{"name":"Abdulrahman Mohamed","id":"1351989794859335"},"message":"Ayman Fekri عندك حل للحوار ده يابرنس ؟","can_remove":false,"like_count":0,"message_tags":[{"id":"10154926026276011","length":11,"name":"Ayman Fekri","offset":0,"type":"user"}],"user_likes":false,"id":"1194029567303416"},{"created_time":"2016-08-01T21:33:22+0000","from":{"name":"Mohamed Hossam Khedr","id":"10212418088796026"},"message":"الداتابيز نوعها ايه؟ ولو mysql جداولها نوعها ايه؟","can_remove":false,"like_count":0,"user_likes":false,"id":"1194030117303361"},{"created_time":"2016-08-01T21:40:30+0000","from":{"name":"Osama Mohamed","id":"830345717112933"},"message":"Ahmed Mahfouz","can_remove":false,"like_count":0,"message_tags":[{"id":"10212072846353700","length":13,"name":"Ahmed Mahfouz","offset":0,"type":"user"}],"user_likes":false,"id":"1194032233969816"},{"created_time":"2016-08-01T21:43:34+0000","from":{"name":"Mohamed Fawzy","id":"10158387715885788"},"message":"Use phalcon ?","can_remove":false,"like_count":0,"user_likes":false,"id":"1194033387303034"},{"created_time":"2016-08-01T22:30:24+0000","from":{"name":"Ahmed Khairy Bakr","id":"1300175293353079"},"message":"Optimize you queries and your indexes","can_remove":false,"like_count":1,"user_likes":false,"id":"1194050767301296"},{"created_time":"2016-08-01T22:49:25+0000","from":{"name":"Yahya Sabry","id":"10154673962792886"},"message":"هي ايه كميه الحلول الخزعبليه دي .. كل واحد بيطلب انك تغير حاجه أساسيه في بروجيكت واضح انه كبير و الحركه فيه بقت اصعب ... انصح انك تستخدم حاجه ذي newrelic او بديلها لو لارافيل بيقدم حاجه كده و أتوقع انك هتلاقيها بسهوله ان شاء الله علشان تشوف كل ريكويست بياخد وقت قد ايه .. وحدد الريكويستات اللي محتاجه تظبيط او الكود اللي محتاج optimization و دور عليه هو تحديدا ... و بالمناسبه mongo ممتازة بس فيها عيب ابن كلب ان اغلب الداتا في الميموري و بتsynch علي الهارد كل فتره مع نفسها .. اللي لو قدر الله سيرفر طار او احتجت تعمل ريستارت فأنت هتزعل ... انت ممكن تغير الاوبشن ده انها تكتب علي طول علي الهارد بس هتكون أبطأ","can_remove":false,"like_count":7,"user_likes":false,"id":"1194059520633754"},{"created_time":"2016-08-01T23:12:54+0000","from":{"name":"Hussein Mohamed Momtaz","id":"10155168997803896"},"message":"Abdelrahman Khedr","can_remove":false,"like_count":1,"message_tags":[{"id":"1238819719507235","length":17,"name":"Abdelrahman Khedr","offset":0,"type":"user"}],"user_likes":false,"id":"1194084107297962"},{"created_time":"2016-08-02T01:52:15+0000","from":{"name":"Fouad Abd ELrazek","id":"10212256319542166"},"message":"حضرتك لازم تستخدم حاجة زى newrelic علشان تحدد المشكلة فين لو المشكلة من ال DB ولو انى أشك ممكن تستخدم حاجة زى Redis ده Caching system حيظبطلك الدنيا أوى\nلو المشكلة من الاسكربيت لازم تعمل Code Optimization و ممكن تبص على HipHop for php حيظبطلك الدنيا جامد","can_remove":false,"like_count":4,"user_likes":false,"id":"1194166280623078"},{"created_time":"2016-08-02T07:14:31+0000","from":{"name":"Ahmed Mahfouz","id":"10212072846353700"},"message":"مفيش حل من غير ما تحدد المشكله الاول","can_remove":false,"like_count":1,"user_likes":false,"id":"1194306633942376"},{"created_time":"2016-08-02T08:08:00+0000","from":{"name":"Ahmed Soliman Farghal","id":"10154129092905388"},"message":"First step is to understand your performance baseline and figure out what the bottleneck is, if a request takes so long, is it boggling the CPU time? Is it IO? Neither?  Every combination has some possibilities but I definitely agree that you should not change anything unless you know what you are doing. Profiling and instrumentation are your best friends here.","can_remove":false,"like_count":6,"user_likes":false,"id":"1194331300606576"},{"created_time":"2016-08-02T11:38:18+0000","from":{"name":"Mohamed Yosry","id":"10158629978660393"},"message":"متفق تماما انك لازم تعمل profiling عشان تعرف سبب المشكلة. النقطة التانية الى متوقع ممكن تكون سبب المشكلة انك بتscale vertically.  بمعنى انك واخد جهاز واحد ضخم لكل الapps و هنا ممكن يكون ابليكشن منهم بتاخد الresources بتاعة معظم الجهاز و بتقلل الperformance بتاع بقية البرامج. جرب تفصل تعمل setup من اجهزة اقل بحيث الdb لوحدها  على سيرفر(ات) مناسبة ليها (هارد SSD مثلا) او managed service و تخلي فى كذا سيرفر للweb server و فى load balancer. و الprofiling حيوضحلك لو سبب المشكلة لو كنت محتاح caching مثلا او تحسن queries تقيلة.","can_remove":false,"like_count":1,"user_likes":false,"id":"1194429237263449"},{"created_time":"2016-08-02T12:52:02+0000","from":{"name":"Mohammad Aboelnour","id":"10211609665746652"},"message":"\"you can't optimize what you don't measure\"\nI guess that you should start by using some profiling tool like \"new relic\" as most of the guys told you here.\n\nAnd I guess you should revisit your arch design as you depend on one large machine only, you can start with 2 app servers and a load balancer and measure the difference.\n\nFor caching: you should check why you need caching? and which type of caching you need? page caching, action caching, page fragments caching, low-level caching, SQL caching, ...\n\nCaching is a solution for a specific problem, before applying it, make sure that your problem is a cache problem and can't be solved except by caching.\n\nGood Luck.","can_remove":false,"like_count":4,"user_likes":false,"id":"1194479743925065"},{"created_time":"2016-08-02T14:28:20+0000","from":{"name":"Mu Hamz","id":"10155072085541241"},"message":"ان السيرفر كبير 21 كور و 64 جيجا رامات .\nكان دايما بيدي مشكلة في ال getway .\nHow did you do that and Why did u do it ?\nظبطنا Nignix علي اكتر من سيرفر و  الDistributed Database بال Mongo\nWhat's your configuration and What's your MongoDB configuration ?\n\nDid you Enable  Database Profiling ? and Do you use Replica Set Oplog or not ?","can_remove":false,"like_count":1,"user_likes":false,"id":"1194529767253396"},{"created_time":"2016-08-02T14:33:48+0000","from":{"name":"Mu Hamz","id":"10155072085541241"},"message":"and As the previous comment listed  : \" you can't optimize what you don't measure \" .  Seems you already did many optimisations  without measuring .","can_remove":false,"like_count":1,"user_likes":false,"id":"1194531843919855"},{"created_time":"2016-08-02T16:06:02+0000","from":{"name":"Ahmed M. Araby","id":"10154630737934263"},"message":"فرجاني فرجاني , بص , عايزك تركز شوية :D\nمافيش حد هايقدر يقولك ايه المشكله \nاي حل هاتجربه دلوقتي كدا , هاتبقي زي اللي اللي بيغمض عنيه وماسك مسدس وبيحاول يضرب عصفوره :D بالظبط كدا\nلو قعدت جربت في حلول للصبح عشوائي من غير ماتكون عارف ايه المشكله نفسها هاتبقي انت وحظك\nلازم تفتح عينك كدا وتحاول تحلل وتفهم وتشوف\nدي بداية \nhttp://stackoverflow.com/questions/18451681/how-to-find-queries-not-using-indexes-or-slow-in-mongodb","can_remove":false,"like_count":4,"user_likes":false,"id":"1194578943915145"},{"created_time":"2016-08-03T13:38:15+0000","from":{"name":"Mohamed Fergany","id":"10212218310718439"},"message":"شكرا يا شباب علي المساعدة \nاحنا كان عندنا اسرع اننا نجرب فريموورك تاني تحديدا فالكون في الجزء دا من الابلكيشن الي بيعمل لود . لان من المقارنات علي المواقع لارفيل من اتقل الفريمووركس الي بتعمل لود\nبعد ما غيرنا الفريم وورك الوقت نزل من 5 ثواني ل 200 ملثانية . ودا رقم افضل بكتير بالنسبة لينا \nهنبدأ نستخدم باذن الله كل الي انتو قولتوه هنا وهنجرب لغاية ما ننزل الرقم اقل من كدا . \nوهكتب باذن الله تجربة للي حصل بشكل كامل\nشكرا مرة تاني","can_remove":false,"like_count":5,"user_likes":false,"id":"1195193147187058"}],"paging":{"cursors":{"before":"WTI5dGJXVnVkRjlqZAFhKemIzSTZANVEU1TkRBd01UTXpOek13TmpJek9Ub3hORGN3TURnek9UVXkZD","after":"WTI5dGJXVnVkRjlqZAFhKemIzSTZANVEU1TlRFNU16RTBOekU0TnpBMU9Eb3hORGN3TWpNeE5EazEZD"}}}}