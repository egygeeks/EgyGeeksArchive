{"id":"172338516139198_934592836580425","from":{"name":"Osama Soliman","id":"709206249239999"},"message":"Just wondering ... what happens if two persons commented in the same time -same ms- or even smaller unit ? .... how facebook db or any other db will handle this ?","actions":[{"name":"Comment","link":"https://www.facebook.com/172338516139198/posts/934592836580425"},{"name":"Like","link":"https://www.facebook.com/172338516139198/posts/934592836580425"},{"name":"Report Post to Admin","link":"https://www.facebook.com/groups/egyptian.geeks/members/"}],"privacy":{"value":"","description":"","friends":"","allow":"","deny":""},"type":"status","created_time":"2015-05-01T17:12:19+0000","updated_time":"2015-05-02T09:55:08+0000","is_hidden":false,"is_expired":false,"likes":{"data":[{"id":"1490495194308663","name":"Muhammed Abuali"},{"id":"10154887093460568","name":"Mohamed Rashed"},{"id":"1190206551076596","name":"Mohamed Wael"},{"id":"1253681964729491","name":"Eslam Esmaeal"}],"paging":{"cursors":{"before":"MTQ5MDQ5NTE5NDMwODY2MwZDZD","after":"MTI1MzY4MTk2NDcyOTQ5MQZDZD"}}},"comments":{"data":[{"created_time":"2015-05-01T17:20:25+0000","from":{"name":"Mahmoud Said","id":"10158340042205183"},"message":"they are indexed by a unique id, not by the timestamp","can_remove":false,"like_count":2,"user_likes":false,"id":"934594359913606"},{"created_time":"2015-05-01T17:27:47+0000","from":{"name":"Osama Soliman","id":"709206249239999"},"message":"I meant on the same post ... which one will appear first to us :D !","can_remove":false,"like_count":0,"user_likes":false,"id":"934601303246245"},{"created_time":"2015-05-01T17:39:05+0000","from":{"name":"Osama Soliman","id":"709206249239999"},"message":"so for example ur comment id=934594359913606 \nmine is=934601303246245 \nif they were just at the same time ... took the same ID what would happen 😂  !","can_remove":false,"like_count":0,"user_likes":false,"id":"934604209912621"},{"created_time":"2015-05-01T17:47:09+0000","from":{"name":"Moataz Mahmoud","id":"1266447236802029"},"message":"The term \"at the same time\" is meaningless here, it makes no sense. If you comment at the time, then one comment reaches the database before the other, due to some connection issues and routing. It's the same the marathon, does it make sense that there are two runners reaches the FINISH line at the same time!","can_remove":false,"like_count":2,"user_likes":false,"id":"934606679912374"},{"created_time":"2015-05-01T18:06:11+0000","from":{"name":"Ahmad Fatoum","id":"1068666063239339"},"message":"^ It does make sense, say on a multiprocessor system.\nFor that reason, MySQL locks part (or all) of the table when doing stuff. That allows for something like auto_increment which takes care of generating an id, that's never a duplicate.","can_remove":false,"like_count":6,"user_likes":false,"id":"934611909911851"},{"created_time":"2015-05-01T18:27:13+0000","from":{"name":"Moutaz Shams","id":"1647326241951498"},"message":"قاعدة البيانات مش زي الملفات، كل أنظمة إدارة قواعد البيانات بتضمن عدم حدوث المشكلات اللي من النوع ده من غير ما المطور يعمل حاجه، فوق ده المطور المفروض يصمم الجدول بحيث يكون فيه Primary Key مميز يستحيل إنه يتكرر في الجدول، وأي نظام بيوفر ويضمن ده، اللي هو الـ Id مثلا في الحالة دي، ده من ناحية التخزين، إنما من ناحية استرجاع البيانات فالكود اللي بيجيب التعليقات بيرتبها غالبا بكذا حاجه، بالوقت وبعدد اللايكات وقرب المستخدم منك مثلا والخ.. وعموما لو كل كل كل الشروط بتتطابق تماما مع كافة التعليقات ومن ضمنها الوقت باللحظة فهتلائيها تختلف غالبا بين كل نظام، بعض الأنظمة هترتبهم بحسب الأقدمية (بحسب الصف اللي إتخزن الأول في الجدول، أو العكس) أو اللي تقدر تسترجعه أسرع من الهارد-ديسك أو كدا والخ\n\nبالمناسبة  قريب كنت بأرتب منتجات بحسب الأسعار فقط في صفحة فيها Paging فكانت بتعمل مشكلة لأن لما السعر يتكرر كان نظام قاعدة البيانات أو أحد الـ Layers اللي مابين الدنيتين بيرتبهم عشوائيا لما السعر يكون واحد، فكان ده بيعمل مشكلة لأن في الحالة دي بعض المنتجات ممكن ماتتعرضش للمستخدم وهو بينتقل بين الصفحات أو على أقل تقدير لما يعمل ريفريش أو back هيلائي المنتجات ترتيبها اختلف والخ لذلك قررت إن أنا دايما أحط الـ Id المميز في الـ order by دايما حتى لو مش عايز أرتبهم، بعكس ما ينصح به بإنك ماتعملش order by أو ماتزودش فيه علشان السرعة","can_remove":false,"like_count":1,"user_likes":false,"id":"934616946578014"},{"created_time":"2015-05-01T18:40:38+0000","from":{"name":"Moataz Mahmoud","id":"1266447236802029"},"message":"What you said doesn't mean that it makes sense. When the database is shared for all the cores, then the arrival time of two packages mayn't be the same!","can_remove":false,"like_count":0,"user_likes":false,"id":"934621596577549"},{"created_time":"2015-05-01T18:43:45+0000","from":{"name":"Fady Anwar","id":"10158301408785052"},"message":"This question boils down to networking, basically you are asking is it possible for two packets to reach the same destination on the same time with the exact timestamp I.e. on the same wire.. and if you look at it this way you will figure it out by yourself.. obviously you can't..","can_remove":false,"like_count":2,"user_likes":false,"id":"934622456577463"},{"created_time":"2015-05-01T18:53:22+0000","from":{"name":"Fady Anwar","id":"10158301408785052"},"message":"For example ofcourse any online server  receives millions of packets in the same time, usually they use some sort of queuing data structure to handle requests, so how your packet gets ordered in this queue? Will in the end of the day it will boil down to the actual elecric signal on some wire in zeros and ones.. you can never be able to fit two bits in one bit unless it's a Shrewdinger's bit :-)","can_remove":false,"like_count":2,"user_likes":false,"id":"934625226577186"},{"created_time":"2015-05-01T19:29:08+0000","from":{"name":"Ahmad Fatoum","id":"1068666063239339"},"message":"Ok, packet 1 arrived then packet 2 arrived. Most databases don't block when they handle a query, they accept new queries too. So they offload the execution of query1 to one thread and query2 to another thread. If each thread runs on another core, they can run at exactly the same time.\nYour networking example might be true, if there is a single core real time system on the receiving end, which won't be ever the case.\n\nTo answer the specific questions:\nMoataz Mahmoud Yes, the network interface doesn't receive 2 packets at the same time. But they can very well be processed at the exact same time, which is what matters. In that case it's not unlikely they have the same timestamp. Physics might treat time as continuous but system time will always be discrete. That means there is a finite resolution, two consecutive calls to whatever get_system_time functions might return the same value.\nIf you insert by id, it can be possible that you attempt insertion of the same id from two different threads at the same time. That's called a race condition and can be avoided by a lock, which MySQL (which Facebook uses) indeed does.\nFady Anwar I think I addressed all the points above. It boils down to nondeterministic order of execution => race condition => need for a locking mechanism.","can_remove":false,"like_count":2,"message_tags":[{"id":"1266447236802029","length":14,"name":"Moataz Mahmoud","offset":455,"type":"user"},{"id":"10158301408785052","length":10,"name":"Fady Anwar","offset":1130,"type":"user"}],"user_likes":false,"id":"934644383241937"},{"created_time":"2015-05-01T19:54:38+0000","from":{"name":"Youhana Sobhy","id":"10155224130892376"},"message":"By default every behaviour have an ID","can_remove":false,"like_count":0,"user_likes":false,"id":"934653356574373"},{"created_time":"2015-05-01T21:56:12+0000","from":{"name":"Mostafa Farghaly","id":"1261672950590077"},"message":"Queue","can_remove":false,"like_count":0,"user_likes":false,"id":"934679949905047"},{"created_time":"2015-05-02T06:23:50+0000","from":{"name":"Mohamed Moshrif","id":"1235868066468537"},"message":"This would never ever happen. Read more on ACID properties that any respectful RDMBS would support","can_remove":false,"like_count":1,"user_likes":false,"id":"934794589893583"},{"created_time":"2015-05-02T07:44:58+0000","from":{"name":"Fady Anwar","id":"10158301408785052"},"message":"Ahmad Fatoum even on a multicore processor system there will be an instruction id and a thread id that can be used to tell which is first and even before it reaches the processors the network interface will assign a packet id for each packet.. on another hand that's why there is a   database log that keeps tracks of transactions before they actually gets committed to the actual tables.. \nIn the end of the day I don't really think Facebook people really care who made the first comment to the extent that they design their databases in a way that might hinder their performance just to keep track of it :-)","can_remove":false,"like_count":1,"message_tags":[{"id":"1068666063239339","length":12,"name":"Ahmad Fatoum","offset":0,"type":"user"}],"user_likes":false,"id":"934811996558509"},{"created_time":"2015-05-02T09:04:15+0000","from":{"name":"Geish","id":"959423756286"},"message":"Facebook doesn't care. If I remember correctly, they don't even care about comments' count when there's a conflict.\nhttp://en.m.wikipedia.org/wiki/Eventual_consistency","can_remove":false,"like_count":1,"user_likes":false,"id":"934829029890139"},{"created_time":"2015-05-02T09:21:23+0000","from":{"name":"Fady Anwar","id":"10158301408785052"},"message":"Osama Soliman from the ongoing discussion I can say good question!","can_remove":false,"like_count":0,"message_tags":[{"id":"709206249239999","length":13,"name":"Osama Soliman","offset":0,"type":"user"}],"user_likes":false,"id":"934832523223123"},{"created_time":"2015-05-02T09:55:08+0000","from":{"name":"Osama Soliman","id":"709206249239999"},"message":"Fady Anwar the most interesting thing that I am a frontend designer and even a noob one :D and couldn't understand upto 30% of the discussion :') but I do enjoy it ;) ... thx for the compliment <3 ^_^","can_remove":false,"like_count":0,"message_tags":[{"id":"10158301408785052","length":10,"name":"Fady Anwar","offset":0,"type":"user"}],"user_likes":false,"id":"934838929889149"}],"paging":{"cursors":{"before":"WTI5dGJXVnVkRjlqZAFhKemIzSTZAPVE0wTlRrME16VTVPVEV6TmpBMk9qRTBNekExTURBNE1qVT0ZD","after":"WTI5dGJXVnVkRjlqZAFhKemIzSTZAPVE0wT0RNNE9USTVPRGc1TVRRNU9qRTBNekExTmpBMU1EZAz0ZD"}}}}